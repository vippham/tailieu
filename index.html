<!DOCTYPE html>
<html lang="vi" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang T·ªïng H·ª£p T√†i Li·ªáu</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.11.1/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #2DD4BF; --primary-focus: #14B8A6; --primary-content: #000000;
            --secondary: #5EEAD4; --secondary-focus: #2DD4BF; --secondary-content: #000000;
            --accent: #A7F3D0; --accent-focus: #5EEAD4; --accent-content: #000000;
            --neutral: #374151; --neutral-focus: #4B5563; --neutral-content: #F3F4F6;
            --base-100: #1F2937; --base-200: #111827; --base-300: #0F172A; --base-content: #D1D5DB;
            --info: #0EA5E9; --info-content: #FFFFFF; --success: #22C55E; --success-content: #FFFFFF;
            --warning: #F59E0B; --warning-content: #000000; --error: #EF4444; --error-content: #FFFFFF;
            --rounded-box: 1rem; --rounded-btn: 0.5rem;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--base-200); color: var(--base-content); }
        .container.mx-auto { background-color: var(--base-100); color: var(--base-content); border: 1px solid var(--neutral); }
        .input { background-color: var(--neutral); border-color: var(--neutral-focus); color: var(--neutral-content); }
        .input::placeholder { color: #9CA3AF; }
        .input:focus { outline: 2px solid var(--primary); outline-offset: 2px; border-color: var(--primary); }
        .btn-primary { background-color: var(--primary); border-color: var(--primary); color: var(--primary-content); font-weight: 600; }
        .btn-primary:hover { background-color: var(--primary-focus); border-color: var(--primary-focus); }
        .table thead th { background-color: var(--neutral); color: var(--neutral-content); border-bottom: 2px solid var(--primary); }
        .table tbody tr { border-bottom: 1px solid var(--neutral); }
        .table tbody tr:nth-child(even) { background-color: var(--base-300); }
        .table tbody tr:hover { background-color: var(--neutral-focus) !important; color: #FFFFFF; }
        .loading-spinner { border: 4px solid rgba(209, 213, 219, 0.2); width: 36px; height: 36px; border-radius: 50%; border-left-color: var(--primary); animation: spin 1s ease infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .alert { border-radius: var(--rounded-box); }
        .alert-info { background-color: var(--info); color: var(--info-content); }
        .alert-success { background-color: var(--success); color: var(--success-content); }
        .alert-warning { background-color: var(--warning); color: var(--warning-content); }
        .alert-error { background-color: var(--error); color: var(--error-content); }
        .alert svg { stroke: currentColor; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--base-300); }
        ::-webkit-scrollbar-thumb { background-color: var(--primary); border-radius: 10px; border: 2px solid var(--base-300); }
        ::-webkit-scrollbar-thumb:hover { background-color: var(--primary-focus); }
        header h1 { text-shadow: 0px 2px 4px rgba(0,0,0,0.3); }
        .table th, .table td { padding: 0.5rem; }
        @media (min-width: 640px) { .table th, .table td { padding: 0.75rem 1rem; } }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen p-2 sm:p-4 md:p-8">

    <div class="container mx-auto bg-base-100 p-3 sm:p-4 md:p-6 rounded-lg shadow-2xl">
        <header class="mb-6 md:mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-primary mb-2">üìö Kho T√†i Li·ªáu S·ªë</h1>
            <p class="text-md sm:text-lg text-base-content/80">N∆°i chia s·∫ª v√† t√¨m ki·∫øm t√†i li·ªáu h·ªçc t·∫≠p</p>
        </header>

        <div class="mb-6 md:mb-8">
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm..." class="input input-bordered w-full p-3 text-sm sm:text-base md:p-4 md:text-lg" onkeyup="filterTable()">
        </div>

        <div id="messageArea" class="mb-4"></div>

        <div class="overflow-x-auto shadow-md rounded-lg">
            <table class="table table-fixed w-full text-xs sm:text-sm md:text-base" id="taiLieuTable">
                <thead>
                    <tr>
                        <th class="w-[5%] sm:w-[5%] text-left">STT</th>
                        <th class="w-[25%] sm:w-[20%] md:w-[25%] text-left">N·ªôi dung</th>
                        <th class="w-[30%] sm:w-[30%] md:w-[25%] text-left">T√™n t√†i li·ªáu</th>
                        <th class="w-[20%] sm:w-[20%] md:w-[15%] text-left">M√¥n h·ªçc</th>
                        <th class="w-[20%] hidden md:table-cell text-left">Ng√†y ƒëƒÉng t·∫£i</th>
                        <th class="w-[10%] sm:w-[10%] md:w-[10%] text-center">Link</th>
                    </tr>
                </thead>
                <tbody id="taiLieuTableBody">
                    <tr>
                        <td colspan="6" class="text-center py-10">
                            <div class="loading-spinner mx-auto"></div>
                            <p class="mt-3 text-lg">ƒêang t·∫£i d·ªØ li·ªáu, vui l√≤ng ch·ªù...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <footer class="mt-12 pt-8 border-t border-neutral text-center text-sm text-base-content/70">
            <p>&copy; <span id="currentYear"></span> - Trang web t·ªïng h·ª£p t√†i li·ªáu.</p>
            <p>Ph√°t tri·ªÉn v·ªõi ‚ù§Ô∏èb·ªüi Khang Ng√¥,Ph√∫c Ti·∫øn.</p>
        </footer>
    </div>

    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // --- C·∫§U H√åNH C·ª¶A B·∫†N (ƒê√É C·∫¨P NH·∫¨T) ---
        const SHEET_ID = '1n9_vsRzPWOW7w4jgLI6vjbGF1LcEoR4tMxrpEg4N4uI';
        const API_KEY = 'AIzaSyCZ8p4pw-L_CyMSM4uEHXSszJC1MWespo4'; // C·∫¢NH B√ÅO: Key n√†y ƒëang c√¥ng khai. H√£y thay th·∫ø b·∫±ng key m·ªõi v√† b·∫£o m·∫≠t!
        const SHEET_NAME = 'Trang t√≠nh1';
        const DATA_RANGE = 'A2:E';
        const DATA_COLUMNS_TO_DISPLAY_TEXT = 4; // (N·ªôi dung, T√™n, M√¥n, Ng√†y)
        const LINK_COLUMN_INDEX = 4;  // Ch·ªâ s·ªë c·ªßa c·ªôt Link (c·ªôt E)
        const TOTAL_DESKTOP_COLUMNS = 6; // STT + N·ªôi dung + T√™n + M√¥n + Ng√†y + Link
        // --- K·∫æT TH√öC C·∫§U H√åNH ---

        const tableBody = document.getElementById('taiLieuTableBody');
        const messageArea = document.getElementById('messageArea');
        const searchInput = document.getElementById('searchInput');

        async function fetchSheetData() {
            if (API_KEY === 'AIzaSyCZ8p4pw-L_CyMSM4uEHXSszJC1MWespo4') {
                 displayMessage('C√°c b·∫°n x√†i ƒëi·ªán tho·∫°i ch·ªãu kh√≥ t·∫£i b·∫±ng Google Drive gi√∫p m√¨nh nh√°.', 'warning');
                 // B·∫°n c√≥ th·ªÉ quy·∫øt ƒë·ªãnh c√≥ d·ª´ng th·ª±c thi ·ªü ƒë√¢y kh√¥ng n·∫øu mu·ªën
                 // return;
            }
            if (!SHEET_ID || SHEET_ID === 'YOUR_SHEET_ID' || !API_KEY || API_KEY === 'YOUR_API_KEY_PLACEHOLDER') { // S·ª≠a placeholder n·∫øu b·∫°n d√πng t√™n kh√°c
                displayMessage('Vui l√≤ng c·∫•u h√¨nh SHEET_ID v√† API_KEY h·ª£p l·ªá trong file HTML.', 'error');
                tableBody.innerHTML = `<tr><td colspan="${TOTAL_DESKTOP_COLUMNS}" class="text-center text-error py-10 font-semibold">L·ªói: Ch∆∞a c·∫•u h√¨nh SHEET_ID ho·∫∑c API_KEY.</td></tr>`;
                return;
            }

            const encodedSheetName = encodeURIComponent(SHEET_NAME);
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodedSheetName}!${DATA_RANGE}?key=${API_KEY}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => null);
                    console.error('Error fetching data:', response.status, response.statusText, errorData);
                    let errorMessage = `L·ªói ${response.status}: ${response.statusText}. Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.`;
                    if (errorData && errorData.error && errorData.error.message) {
                        errorMessage += ` Chi ti·∫øt: ${errorData.error.message}`;
                         if (errorData.error.message.toLowerCase().includes("unable to parse range")) {
                            errorMessage += ` Ki·ªÉm tra l·∫°i SHEET_NAME ('${SHEET_NAME}') v√† DATA_RANGE ('${DATA_RANGE}') c√≥ ƒë√∫ng v·ªõi c·∫•u tr√∫c Google Sheet c·ªßa b·∫°n kh√¥ng (Sheet ID: '${SHEET_ID}').`;
                        } else if (errorData.error.details && errorData.error.details[0] && errorData.error.details[0].reason === "API_KEY_INVALID") {
                             errorMessage += " API Key c·ªßa b·∫°n kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ b·ªã thu h·ªìi/gi·ªõi h·∫°n kh√¥ng ƒë√∫ng c√°ch.";
                        } else if (errorData.error.status === "PERMISSION_DENIED") {
                            errorMessage += " Google Sheet ch∆∞a ƒë∆∞·ª£c chia s·∫ª c√¥ng khai (ch·∫ø ƒë·ªô 'B·∫•t k·ª≥ ai c√≥ ƒë∆∞·ªùng li√™n k·∫øt ƒë·ªÅu c√≥ th·ªÉ xem').";
                        }
                    }
                    displayMessage(errorMessage, 'error');
                    tableBody.innerHTML = `<tr><td colspan="${TOTAL_DESKTOP_COLUMNS}" class="text-center text-error py-10 font-semibold">${escapeHtml(errorMessage)}</td></tr>`;
                    return;
                }
                const data = await response.json();
                displayData(data.values);
            } catch (error) {
                console.error('Error fetching or parsing data:', error);
                displayMessage(`Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: ${error.message}. Ki·ªÉm tra console v√† k·∫øt n·ªëi m·∫°ng.`, 'error');
                tableBody.innerHTML = `<tr><td colspan="${TOTAL_DESKTOP_COLUMNS}" class="text-center text-error py-10 font-semibold">L·ªói khi t·∫£i d·ªØ li·ªáu.</td></tr>`;
            }
        }

        function displayData(rows) {
            tableBody.innerHTML = '';
            if (!rows || rows.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="${TOTAL_DESKTOP_COLUMNS}" class="text-center py-10 text-lg">Kh√¥ng c√≥ t√†i li·ªáu n√†o.</td></tr>`;
                return;
            }

            rows.forEach((row, index) => {
                if (row.length < LINK_COLUMN_INDEX + 1 && row.filter(String).length === 0) { return; }

                const tr = document.createElement('tr');
                tr.className = 'hover';
                let cellsHtml = `<th class="text-left">${index + 1}</th>`;

                for (let i = 0; i < DATA_COLUMNS_TO_DISPLAY_TEXT; i++) {
                    const cellData = row[i] || '';
                    let displayedContent = '';
                    let cellClass = '';

                    if (i === 0) {
                        if (cellData.toLowerCase().includes('drive.google.com') || cellData.toLowerCase().includes('link')) {
                            displayedContent = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 inline-block align-middle text-primary"><path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0l-4-4a2 2 0 012.828-2.828l.707.707-1.707 1.707a.5.5 0 00.707.707l1.707-1.707z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M8.414 15.414a2 2 0 102.828-2.828l-3-3a2 2 0 00-2.828 0l-4 4a2 2 0 002.828 2.828l.707-.707-1.707-1.707a.5.5 0 11.707-.707l1.707 1.707z" clip-rule="evenodd" /></svg> <span class="hidden sm:inline">Link</span>`;
                        } else if (cellData.length > 25) {
                            displayedContent = `<span title="${escapeHtml(cellData)}">${escapeHtml(cellData.substring(0, 20))}...</span>`;
                        } else {
                            displayedContent = escapeHtml(cellData);
                        }
                    } else if (i === 3) { // C·ªôt "Ng√†y ƒëƒÉng t·∫£i" (ch·ªâ s·ªë 3)
                        displayedContent = escapeHtml(cellData);
                        cellClass = "hidden md:table-cell";
                    }
                    else {
                        displayedContent = escapeHtml(cellData);
                    }
                    cellsHtml += `<td class="${cellClass}">${displayedContent}</td>`;
                }

                const linkUrl = row[LINK_COLUMN_INDEX] || '';
                if (linkUrl.trim() !== '' && (linkUrl.startsWith('http://') || linkUrl.startsWith('https://'))) {
                    cellsHtml += `
                        <td class="text-center">
                            <a href="${escapeHtml(linkUrl)}" target="_blank" rel="noopener noreferrer" class="btn btn-primary btn-xs sm:btn-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 sm:w-5 sm:h-5 inline-block align-middle"><path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z" /><path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" /></svg>
                                <span class="hidden sm:inline ml-1">T·∫£i</span>
                            </a>
                        </td>`;
                } else {
                    cellsHtml += `<td></td>`;
                }
                tr.innerHTML = cellsHtml;
                tableBody.appendChild(tr);
            });
        }

        function displayMessage(message, type = 'info') {
            messageArea.innerHTML = '';
            const alertClasses = { info: 'alert-info', success: 'alert-success', warning: 'alert-warning', error: 'alert-error' };
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClasses[type] || 'alert-info'} shadow-lg transition-all duration-300 ease-in-out transform opacity-0 translate-y-2`;
            alertDiv.setAttribute('role', 'alert');
            let iconSvg = '';
            switch(type) {
                case 'error': iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'; break;
                case 'success': iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'; break;
                default: iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            }
            alertDiv.innerHTML = `<div class="flex items-center">${iconSvg}<span class="ml-2">${escapeHtml(message)}</span></div>`;
            messageArea.appendChild(alertDiv);
            setTimeout(() => { alertDiv.classList.remove('opacity-0', 'translate-y-2'); alertDiv.classList.add('opacity-100', 'translate-y-0'); }, 10);
            if (type !== 'error' || message.startsWith('C·∫¢NH B√ÅO B·∫¢O M·∫¨T')) { // Gi·ªØ c·∫£nh b√°o b·∫£o m·∫≠t l√¢u h∆°n
                 setTimeout(() => {
                    alertDiv.classList.add('opacity-0', 'translate-y-2');
                    setTimeout(() => { if(messageArea.contains(alertDiv)) messageArea.removeChild(alertDiv); }, 300);
                }, message.startsWith('C·∫¢NH B√ÅO B·∫¢O M·∫¨T') ? 15000 : 7000); // 15 gi√¢y cho c·∫£nh b√°o API key
            }
        }

        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') { return unsafe; }
            return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }
        function filterTable() {
            const filter = searchInput.value.toUpperCase().trim();
            const rows = tableBody.getElementsByTagName('tr');
            let found = false;
            let hasVisibleContentRow = false;

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 1 && cells[0].getAttribute('colspan')) { rows[i].style.display = ''; continue; }
                if (rows[i].id === 'noResultsRow') { continue; }

                let displayRow = false;
                if (cells.length > 0) {
                    hasVisibleContentRow = true;
                    for (let j = 0; j < DATA_COLUMNS_TO_DISPLAY_TEXT; j++) {
                        const cellIsActuallyHidden = cells[j].classList.contains('hidden') || (cells[j].classList.contains('md:table-cell') && window.innerWidth < 768);
                        if (cells[j] && !cellIsActuallyHidden && cells[j].textContent.toUpperCase().indexOf(filter) > -1) {
                            displayRow = true;
                            found = true;
                            break;
                        }
                    }
                    rows[i].style.display = displayRow ? '' : 'none';
                }
            }
            const noResultsRow = document.getElementById('noResultsRow');
            if (noResultsRow) { noResultsRow.remove(); }
            if (!found && filter !== '' && hasVisibleContentRow) {
                const newNoResultsRow = tableBody.insertRow();
                newNoResultsRow.id = 'noResultsRow';
                const cell = newNoResultsRow.insertCell();
                cell.colSpan = TOTAL_DESKTOP_COLUMNS;
                cell.className = 'text-center py-10 text-lg';
                cell.textContent = 'Kh√¥ng t√¨m th·∫•y t√†i li·ªáu n√†o ph√π h·ª£p.';
            }
        }
        fetchSheetData();
    </script>
</body>
</html>
